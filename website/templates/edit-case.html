{% extends "base.html" %}

{% block title %}
    Edit Case
{% endblock %}

{% block content %}
    <div class="container mt-4">
        <div class="text-center">
            <h1>Edit Case</h1>
            <hr />
        </div>

        <form method="post">
            <div class="form-group">
                <label for="exampleInputTitle1">Title</label>
                <input
                    type="text"
                    class="form-control"
                    id="exampleInputTitle1"
                    name="title"
                    value="{{ case.title }}"
                    placeholder="Enter title"
                />
            </div>
            <div class="form-group">
                <label for="exampleInputDetails1">Details</label>
                <input
                    type="text"
                    class="form-control"
                    id="exampleInputDetails1"
                    name="details"
                    value="{{ case.details }}"
                    placeholder="Enter details"
                />
            </div>
            <div class="form-group">
                <label for="exampleInputFullName1">Full name</label>
                <input
                    type="text"
                    class="form-control"
                    id="exampleInputFullName1"
                    name="full_name"
                    value="{{ case.full_name }}"
                    placeholder="Enter full name"
                />
            </div>
            <div class="form-group">
                <label for="exampleInputPhone1">Phone number</label>
                <input
                    type="text"
                    class="form-control"
                    id="exampleInputPhone1"
                    name="phone"
                    value="{{ case.phone }}"
                    placeholder="Enter phone number"
                />
            </div>
            <div class="btn-group" role="group">
                <button type="submit" class="btn btn-primary">Submit</button>
                <button
                    type="button"
                    class="btn btn-danger ml-2"
                    onclick="deleteCase(this)"
                    data-case-id="{{ case.id }}"
                >
                    Delete
                </button>
            </div>
        </form>
    </div>

    <script>
        function deleteCase(button) {
            var caseId = button.getAttribute("data-case-id");
            if (confirm("Are you sure you want to delete this case?")) {
                fetch("/delete-case", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({ case_id: caseId }),
                })
                    .then((response) => {
                        if (response.ok) {
                            window.location.href = "/";
                        } else {
                            response.json().then((data) => {
                                alert(data.error || "Failed to delete the case.");
                            });
                        }
                    })
                    .catch((error) => {
                        alert("Failed to delete the case.");
                    });
            }
        }
    </script>
{% endblock %}
