{% extends "base.html" %}

{% block title %}
    New Note
{% endblock %}

{% block content %}
    <div class="container mt-4">
        <div class="text-center">
            <h1>New Note</h1>
            <hr />
        </div>

        <form method="post" onsubmit="return validateForm()">
            <div class="form-group">
                <label for="inlineFormCustomSelectCase">Select Case</label>
                <select
                    class="custom-select my-1 mr-sm-2"
                    name="case_id"
                    id="inlineFormCustomSelectCase"
                >
                    {% for case in cases %}
                        <option value="{{ case.id }}">{{ case.title }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group">
                <label for="inlineFormCustomSelectCourt">Select Court</label>
                <select
                    class="custom-select my-1 mr-sm-2"
                    name="court_id"
                    id="inlineFormCustomSelectCourt"
                >
                    {% for court in courts %}
                        <option value="{{ court.id }}">{{ court.title }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group">
                <label for="inlineFormCustomSelectStatus">Select Status</label>
                <select
                    class="custom-select my-1 mr-sm-2"
                    name="status"
                    id="inlineFormCustomSelectStatus"
                >
                    <option value="resolved">resolved</option>
                    <option value="pending">pending</option>
                    <option value="rejected">rejected</option>
                </select>
            </div>
            <div class="form-group">
                <label for="exampleInputDetails1">Details</label>
                <input
                    type="text"
                    class="form-control"
                    id="exampleInputDetails1"
                    name="details"
                    placeholder="Enter details"
                />
            </div>
            <div class="form-group">
                <label for="exampleInputDate1">Date</label>
                <input type="date" class="form-control" id="exampleInputDate1" name="date" />
            </div>
            <div class="form-group">
                <label for="exampleInputTime1">Time</label>
                <input type="time" class="form-control" id="exampleInputTime1" name="time" />
            </div>
            <button type="submit" class="btn btn-primary">Submit</button>
        </form>
    </div>

    <script>
        function validateForm() {
            var case_id = document.getElementById("inlineFormCustomSelectCase").value;
            var court_id = document.getElementById("inlineFormCustomSelectCourt").value;
            var status = document.getElementById("inlineFormCustomSelectStatus").value;
            var details = document.getElementById("exampleInputDetails1").value;
            var date = document.getElementById("exampleInputDate1").value;
            var time = document.getElementById("exampleInputTime1").value;
            var forbiddenChars = [
                ";",
                "--",
                "'",
                '"',
                "=",
                "<",
                ">",
                "|",
                "&",
                "$",
                "@",
                "%",
                "^",
                "*",
                "(",
                ")",
                "[",
                "]",
                "{",
                "}",
                "`",
                "~",
            ];
            var regex = new RegExp(
                "[" + forbiddenChars.join("").replace(/[-[\]{}()*+?.,\\^$|#\s]/g, "\\$&") + "]"
            );

            if (regex.test(details)) {
                alert("Input contains forbidden characters.");
                return false;
            }

            if (!isValidDate(date)) {
                alert("Invalid date format.");
                return false;
            }

            if (!isValidTime(time)) {
                alert("Invalid time format.");
                return false;
            }

            return true;
        }

        function isValidDate(dateString) {
            var regEx = /^\d{4}-\d{2}-\d{2}$/;
            return dateString.match(regEx) != null;
        }

        function isValidTime(timeString) {
            var regEx = /^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/;
            return timeString.match(regEx) != null;
        }
    </script>
{% endblock %}
