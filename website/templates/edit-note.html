{% extends "base.html" %}

{% block title %}
Edit Note
{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="text-center">
        <h1>Edit Note</h1>
        <hr>
    </div>

    <form method="post">
        <div class="form-group">
            <label for="clientName">Client Name</label>
            <input type="text" class="form-control" id="clientName" name="client_name" value="{{ note.client_name }}" placeholder="Enter client name">
        </div>
        <div class="form-group">
            <label for="caseId">Case ID</label>
            <select class="custom-select my-1 mr-sm-2" name="case_id" id="caseId">
                {% for case in cases %}
                <option value="{{ case.id }}" {% if case.id == note.case_id %}selected{% endif %}>{{ case.title }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="form-group">
            <label for="courtId">Court ID</label>
            <select class="custom-select my-1 mr-sm-2" name="court_id" id="courtId">
                {% for court in courts %}
                <option value="{{ court.id }}" {% if court.id == note.court_id %}selected{% endif %}>{{ court.title }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="form-group">
            <label for="status">Status</label>
            <select class="custom-select my-1 mr-sm-2" name="status" id="status">
                <option value="resolved" {% if note.status == 'resolved' %}selected{% endif %}>Resolved</option>
                <option value="pending" {% if note.status == 'pending' %}selected{% endif %}>Pending</option>
                <option value="rejected" {% if note.status == 'rejected' %}selected{% endif %}>Rejected</option>
            </select>
        </div>
        <div class="form-group">
            <label for="details">Details</label>
            <textarea class="form-control" id="details" name="details" placeholder="Enter details">{{ note.details }}</textarea>
        </div>
        <div class="form-group">
            <label for="date">Date</label>
            <input type="date" class="form-control" id="date" name="date" value="{{ note.date }}">
        </div>
        <div class="form-group">
            <label for="time">Time</label>
            <input type="time" class="form-control" id="time" name="time" value="{{ note.time }}">
        </div>
        <div class="btn-group" role="group">
            <button type="submit" class="btn btn-primary">Submit</button>
            <button type="button" class="btn btn-danger ml-2" onclick="deleteNote(this)" data-id="{{ note.id }}">Delete</button>
        </div>
    </form>
</div>

<script>
    function deleteNote(button) {
        var noteId = button.getAttribute('data-id');
        if (confirm('Are you sure you want to delete this note?')) {
            fetch('/delete-note', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({id: noteId})
            }).then(response => {
                if (response.ok) {
                    window.location.href = '/view-courts';
                } else {
                    response.json().then(data => {
                        alert(data.error || 'Failed to delete the note.');
                    });
                }
            }).catch(error => {
                alert('Failed to delete the note.');
            });
        }
    }
</script>
{% endblock %}
